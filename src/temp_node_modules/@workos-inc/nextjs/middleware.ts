import { NextMiddleware, NextResponse } from "next/server";
import { updateSession } from "./session";

type AuthkitMiddlewareConfig = {};

export function authkitMiddleware({}: AuthkitMiddlewareConfig = {}): NextMiddleware {
  return function (request, event) {
    // handle any authkit callback error by displaying a generic JSON error message
    const url = new URL(request.url);
    if (url.pathname === "/authkit-callback-error") {
      return NextResponse.json(
        {
          error: {
            message: "Something went wrong",
            description:
              "Couldnâ€™t sign in. If you are not sure what happened, please contact your organization admin.",
          },
        },
        { status: 500 }
      );
    }

    // handle session
    return updateSession(request);
  };
}
